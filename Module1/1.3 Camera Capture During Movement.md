# Lab 1.3: Camera Capture During Movement

## Purpose
This lab integrates camera functionality with robot movement to create a complete inspection workflow. You'll learn to capture synchronized images from multiple cameras at specific locations, creating a practical automated inspection system. This combines everything from Labs 1.1 and 1.2 into a real-world application.

## What You'll Learn
- Accessing and managing multiple camera sources
- Image capture timing and synchronization
- File organization and data management
- Coordinating movement and sensing tasks
- Creating automated inspection workflows

## Prerequisites
- Completed Labs 1.1 and 1.2 successfully
- Understanding of basic image formats (JPEG)
- Sufficient storage space for images (~50MB for full inspection)
- Clear, well-lit inspection area

## Tasks to Complete

### Task 1: Camera System Setup
1. Create a new Python file named `lab1_3_camera_capture.py`
2. Import image client and OpenCV libraries
3. Implement `setup_image_capture()` to:
   - Initialize the image client
   - Create a timestamped directory structure: `inspections/YYYYMMDD_HHMMSS/`
   - Create subdirectories for each camera source
   - Return paths and client object
4. Test by capturing a single image from the front camera

### Task 2: Multi-Camera Capture
1. Implement `capture_inspection_images()` function to:
   - Request images from all 5 fisheye cameras simultaneously
   - Handle cases where cameras might be unavailable
   - Save images with descriptive filenames: `{location}_{camera}_{timestamp}.jpg`
   - Display capture progress to console
2. Add error handling for individual camera failures (continue if one camera fails)
3. Test capturing from all cameras while robot is stationary
4. Verify all 5 images are saved correctly

### Task 3: Image Quality Verification
1. Add a function `verify_image_quality()` that checks:
   - Image file size (should be > 10KB for valid images)
   - Image dimensions are reasonable
   - Image is not completely black (possible lens obstruction)
2. Calculate and log average brightness for each image
3. Flag any images that may have quality issues
4. Display a summary of captured images with their properties

### Task 4: Synchronized Movement and Capture
1. Create an inspection point list with at least 5 locations, the example below is what that could look like:
   ```python
   inspection_points = [
       ("front_wall", 0, 0, 0),
       ("left_corner", 2, 2, 1.57),
       ("back_wall", 2, 4, 3.14),
       ("right_corner", 0, 4, -1.57),
       ("return_start", 0, 0, 0)
   ]
   ```
2. Implement `complete_inspection_routine()` that:
   - Powers on and stands up robot
   - Moves to each inspection point
   - Stabilizes for 2 seconds before capturing
   - Captures images from all cameras
   - Records timestamp and location metadata
   - Safely returns to sitting position
3. Add progress indicators showing current inspection point (e.g., "Point 2 of 5")

### Task 5: Inspection Report Generation
1. Create a function `generate_inspection_report()` that produces:
   - Text file summarizing the inspection
   - List of all captured images with locations
   - Any quality warnings or errors encountered
   - Total inspection time and statistics
   - Battery level at start and end
2. Generate a simple HTML report with embedded thumbnails using this structure:
   ```html
   <html>
     <body>
       <h1>Inspection Report - [Timestamp]</h1>
       <h2>Point 1: [Location Name]</h2>
       <img src="[image_path]" width="400">
       ...
     </body>
   </html>
   ```
3. Include a map/diagram showing inspection point locations

### Task 6: Advanced Features (Optional Challenge)
1. Implement automatic retry for failed image captures
2. Add adjustable image quality settings based on lighting conditions
3. Create a comparison view if running multiple inspections of the same location
4. Add GPS coordinates if available from payload
5. Implement basic image stitching to create panoramas

## Deliverables
- [ ] Working `lab1_3_camera_capture.py` script that completes full inspection
- [ ] Complete set of inspection images organized in timestamped folders
- [ ] Generated inspection report (both text and HTML versions)
- [ ] Video recording showing the complete inspection routine
- [ ] Written summary (2-3 paragraphs) describing:
  - Image quality observations at different locations
  - Any challenges with timing or synchronization
  - Potential improvements for real-world deployments

## Testing Checklist
- [ ] All 5 cameras capture images successfully
- [ ] Images are properly named and organized
- [ ] Inspection routine completes without manual intervention
- [ ] Report accurately reflects captured data
- [ ] No duplicate filenames or overwritten images
- [ ] Robot returns to safe sitting position after completion
- [ ] Total inspection time is reasonable (< 5 minutes for 5 points)

## Inspection Quality Verification
Examine your captured images and verify:
- [ ] Lighting is adequate in all images
- [ ] No motion blur (robot was stable during capture)
- [ ] All cameras have clear, unobstructed views
- [ ] Images show expected coverage of inspection area
- [ ] Timestamps are consistent and sequential

## Common Issues and Hints
- **Blurry images**: Add longer stabilization delay before capture (3-5 seconds)
- **Missing images**: Check camera names match SDK documentation exactly
- **Out of memory**: Reduce image quality or capture fewer simultaneous cameras
- **Inconsistent timing**: Use robot odometry feedback instead of sleep-based timing
- **Dark images**: Inspection area may need additional lighting
- **File organization chaos**: Plan directory structure before starting; use constants for paths

## Real-World Considerations
Consider these questions for your written reflection:
- How would you handle inspection in variable lighting conditions?
- What metadata would be important for industrial inspections?
- How could you detect if an inspection point wasn't properly captured?
- What improvements would make this suitable for daily automated inspections?
- How would you handle network interruptions during inspection?

## Extension Ideas
If you complete the basic requirements early, try:
1. Add voice announcements of inspection progress using text-to-speech
2. Implement emergency pause/resume functionality
3. Create a preview mode that shows camera views without saving
4. Add automatic anomaly detection (e.g., detecting unexpected objects)
5. Stream live camera feeds to a web interface during inspection


## Grading Rubric
- **Functionality** (40%): Does the code work as specified?
- **Code Quality** (20%): Is the code well-organized and documented?
- **Safety** (20%): Are proper safety measures implemented?
- **Completeness** (20%): Are all deliverables submitted?

## Getting Help
- Review the code examples provided in the Boston Dynamics materials
- Check Boston Dynamics SDK documentation: https://dev.bostondynamics.com
- Remember: Struggling with problems is part of the learning process!
